<%-include('../layout/adminHeader')-%>
    <div class="container-scroller">
      <!-- partial:../../partials/_sidebar.html -->
      <nav class="sidebar sidebar-offcanvas" id="sidebar">
        <div class="sidebar-brand-wrapper d-none d-lg-flex align-items-center justify-content-center fixed-top">
          <a class="sidebar-brand brand-logo" href="../../index.html"><img src="../../assets2/images/logo.svg" alt="logo" /></a>
          <a class="sidebar-brand brand-logo-mini" href="../../index.html"><img src="../../assets2/images/logo-mini.svg" alt="logo" /></a>
        </div>
        <ul class="nav">
          <li class="nav-item profile">
            <div class="profile-desc">
              <div class="profile-pic">
                <div class="count-indicator">
                  <img class="img-xs rounded-circle " src="../../assets2/images/faces/face15.jpg" alt="">
                  <span class="count bg-success"></span>
                </div>
                <div class="profile-name">
                  <h5 class="mb-0 font-weight-normal">Henry Klein</h5>
                  <span>Gold Member</span>
                </div>
              </div>
              <a href="#" id="profile-dropdown" data-toggle="dropdown"><i class="mdi mdi-dots-vertical"></i></a>
              <div class="dropdown-menu dropdown-menu-right sidebar-dropdown preview-list" aria-labelledby="profile-dropdown">
                <a href="#" class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-dark rounded-circle">
                      <i class="mdi mdi-settings text-primary"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <p class="preview-subject ellipsis mb-1 text-small">Account settings</p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-dark rounded-circle">
                      <i class="mdi mdi-onepassword  text-info"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <p class="preview-subject ellipsis mb-1 text-small">Change Password</p>
                  </div>
                </a>
                <div class="dropdown-divider"></div>
                <a href="#" class="dropdown-item preview-item">
                  <div class="preview-thumbnail">
                    <div class="preview-icon bg-dark rounded-circle">
                      <i class="mdi mdi-calendar-today text-success"></i>
                    </div>
                  </div>
                  <div class="preview-item-content">
                    <p class="preview-subject ellipsis mb-1 text-small">To-do list</p>
                  </div>
                </a>
              </div>
            </div>
          </li>
          <li class="nav-item nav-category">
            <span class="nav-link">Navigation</span>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/dashboard">
              <span class="menu-icon">
                <i class="mdi mdi-speedometer"></i>
              </span>
              <span class="menu-title">Dashboard</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/user">
              <span class="menu-icon">
                <i class="mdi mdi-speedometer"></i>
              </span>
              <span class="menu-title">All User</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/all-products">
              <span class="menu-icon">
                <i class="mdi mdi-playlist-play"></i>
              </span>
              <span class="menu-title">All Products</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/addproduct">
              <span class="menu-icon">
                <i class="mdi mdi-table-large"></i>
              </span>
              <span class="menu-title">Add a new Products</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/category">
              <span class="menu-icon">
                <i class="mdi mdi-chart-bar"></i>
              </span>
              <span class="menu-title">Category</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/editcategory">
              <span class="menu-icon">
                <i class="mdi mdi-contacts"></i>
              </span>
              <span class="menu-title">Edit Category</span>
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/orders" >
              <span class="menu-icon">
                <i class="mdi mdi-security"></i>
              </span>
              <span class="menu-title">Orders</span>              
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link"  href="/admin/coupens" >
              <span class="menu-icon">
                <i class="mdi mdi-security"></i>
              </span>
              <span class="menu-title">Coupens</span>              
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link"  href="/admin/offer" >
              <span class="menu-icon">
                <i class="mdi mdi-security"></i>
              </span>
              <span class="menu-title">Offer</span>              
            </a>
          </li>
          <li class="nav-item menu-items">
            <a class="nav-link" href="/admin/sales">
              <span class="menu-icon">
                <i class="mdi mdi-file-document-box"></i>
              </span>
              <span class="menu-title">Sales Report</span>
            </a>
          </li>
          <!-- <li class="nav-item menu-items">
            <a class="nav-link" href="">
              <span class="menu-icon">
                <i class="mdi mdi-file-document-box"></i>
              </span>
              <span class="menu-title">Banners</span>
            </a>
          </li> -->
        </ul>
      </nav>
      <!-- partial -->
      <div class="container-fluid page-body-wrapper">
        <!-- partial:../../partials/_navbar.html -->
        <nav class="navbar p-0 fixed-top d-flex flex-row">
          <div class="navbar-brand-wrapper d-flex d-lg-none align-items-center justify-content-center">
            <a class="navbar-brand brand-logo-mini" href="../../index.html"><img src="../../assets/images/logo-mini.svg" alt="logo" /></a>
          </div>
          <div class="navbar-menu-wrapper flex-grow d-flex align-items-stretch">
            <button class="navbar-toggler navbar-toggler align-self-center" type="button" data-toggle="minimize">
              <span class="mdi mdi-menu"></span>
            </button>
            <ul class="navbar-nav w-100">
              <li class="nav-item w-100">
                <form class="nav-link mt-2 mt-md-0 d-none d-lg-flex search">
                  <input type="text" class="form-control" placeholder="Search user">
                </form>
              </li>
            </ul>
            <ul class="navbar-nav navbar-nav-right">  
              <li>
                <a type="button" href="/admin/logout">Logout</a>
               </li>            
      
            </ul>
            <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
              <span class="mdi mdi-format-line-spacing"></span>
            </button>
          </div>
        </nav>
        <!-- partial -->
        <div class="main-panel">
          <div class="content-wrapper">
           
            <table class="table table-striped">
              <thead>
                <tr>
                  <th scope="col">#</th>
                  <th scope="col">Category</th>
                  <th scope="col">Subcategory</th>
                  <th scope="col">Description</th>
                  <th scope="col">Status</th>
                  <th scope="col">Offer</th>
                </tr>
              </thead>
              <tbody>
                <% find.forEach((cate)=>{ %>
                  <tr>
                      <th scope="row"></th>
                      <td><%=cate.name %></td>
                      <td><%=cate.subcategory %></td>
                      <td><%=cate.description %></td>
                      <% if(cate.isBlock  == false){ %>
                          <td>isActive</td>
                      <% } else { %>
                          <td>block</td>
                          <% } %>
                        <td> <% if (cate?.offer && cate?.offer.status) { %>
                          <button type="button" class="btn btn-danger" style="width: 150px;" onclick="removeOffer('<%= cate?._id %>')">Remove Offer</button>
                      <% } else { %>
                          <button type="button" class="btn btn-success" style="width: 150px;"  data-toggle="modal" data-target="#offerModal<%= cate?._id %>">Apply Offer</button>
                      <% } %></td>
                      <form method="post" action="/admin/editcategory?id=<%=cate._id %>">
                          <td><button type="submit" name="action" value="block" class="btn btn-warning">Block</button></td>
                          <td><button type="submit" name="action" value="unblock" class="btn btn-success">Unblock</button></td>
                          <td><button type="submit" name="action" value="update" class="btn btn-primary">Update</button></td>
                          <td><button type="submit" name="action" value="delete" onclick="showAlert()" class="btn btn-danger">Delete</button></td>
                      </form>
                  </tr>
              
                  <!-- Offer Modal -->
                  <div class="modal fade" id="offerModal<%=cate._id %>" tabindex="-1" role="dialog" aria-labelledby="offerModalLabel<%=cate._id %>" aria-hidden="true">
                      <div class="modal-dialog modal-dialog-centered" role="document">
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title" id="offerModalLabel<%=cate._id %>">Select Offer</h5>
                                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                      <span aria-hidden="true">&times;</span>
                                  </button>
                              </div>
                              <div class="modal-body">
                                  <h5>Select an offer:</h5>
                                  <% offer?.forEach((data)=>{ %>
                                      <div>
                                          <input type="radio" id="offer<%=data?._id %>" name="selectedOffer<%=cate?._id %>" value="<%=data?._id %>">
                                          <label for="offer<%=data?._id %>"><%=data?.name%>(<%=data?.percentage %>)</label>
                                      </div>
                                  <% }) %>
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-primary" onclick="applySelectedOffer('<%=cate?._id %>')">Apply</button>
                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              </div>
                          </div>
                      </div>
                  </div>
              <% }) %>
              
                
              </tbody>
            </table>
          </div>
          <!-- content-wrapper ends -->
          <!-- partial:../../partials/_footer.html -->
          
          <!-- partial -->

          




        </div>
        <!-- main-panel ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
<script>
   function showAlert(){
    alert("this wiill delete the category")
   }


  //  function applySelectedOffer(mainCategory,subCategory){
  //     const selectedOfferId = document.querySelector('input[name="selectedOffer"]:checked').value;

  //   const data = {
  //     offerId:selectedOfferId,
  //     mainCategory:mainCategory,
  //     subCategory:subCategory
  //   }

  //   axios.post("/admin/apply-offer",data)
  //   .then(response=>{
  //     console.log(response.data);
  //     if(response.data.success){
  //       Swal.fire({
  //       icon: 'success',
  //       title: 'Offer Applied Successfully!',
  //       text: 'The offer has been applied successfully.',
  //     });
  //     }
  //   })
  //   .catch(error=>{
  //     console.log(error);
  //   })

  //  }



  function applySelectedOffer(categoryId) {
        var selectedOfferId = $("input[name='selectedOffer" + categoryId + "']:checked").val();
        axios.post('/admin/apply-offer', {
            categoryId: categoryId,
            selectedOfferId: selectedOfferId
        })
        .then(function(response) {
            console.log(response.data);
            window.location.reload()
        })
        .catch(function(error) {
            console.error(error);
        });
    }

function removeOffer(categoryId){
  data = {
    categoryId : categoryId
  }
  axios.post("/admin/remove-offer",data)
  .then(function(response) {
            console.log(response.data);
            window.location.reload()
        })
        .catch(function(error) {
            console.error(error);
        });

}


</script>
    

<%-include('../layout/adminHeader')-%>
